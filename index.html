<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RJEZM DIGITAL â€“ Final Boss Pro</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
:root{
  --primary:#8B5CF6;
  --accent:#C4B5FD;
  --bg-light:#F5F3FF;
  --bg-dark:#111827;
  --card-dark:#1F2937;
}

body{
  background:var(--bg-light);
  transition:0.3s;
}

.dark{
  background:var(--bg-dark);
  color:white;
}

.sidebar{
  background:linear-gradient(180deg,#C4B5FD,#8B5CF6);
}

.card{
  background:white;
  border-radius:16px;
  box-shadow:0 10px 30px rgba(0,0,0,0.05);
}

.dark .card{
  background:var(--card-dark);
}

.table-header{
  background:#F3F4F6;
}

.dark .table-header{
  background:#374151;
}
</style>
</head>
<body class="min-h-screen">

<!-- LOGIN -->
<div id="loginScreen" class="flex items-center justify-center h-screen">
  <div class="card p-8 w-80 text-center">
    <h1 class="text-2xl font-bold text-purple-600 mb-4">ðŸ’œ RJEZM DIGITAL</h1>
    <input type="password" id="pinInput" placeholder="Enter PIN"
      class="border p-2 rounded w-full mb-4 text-center">
    <button onclick="login()"
      class="bg-purple-600 text-white px-4 py-2 rounded w-full">
      Unlock
    </button>
  </div>
</div>

<!-- APP -->
<div id="app" class="hidden flex">

  <!-- SIDEBAR -->
  <div class="sidebar w-64 min-h-screen text-white p-6 space-y-6">
    <h2 class="text-xl font-bold">ðŸ’œ RJEZM</h2>
    <nav class="space-y-2">
      <div onclick="showPage('dashboard')" class="cursor-pointer">Dashboard</div>
      <div onclick="showPage('orders')" class="cursor-pointer">Orders</div>
      <div onclick="showPage('customers')" class="cursor-pointer">Customers</div>
      <div onclick="showPage('inventory')" class="cursor-pointer">Inventory</div>
      <div onclick="showPage('backup')" class="cursor-pointer">Backup</div>
      <div onclick="toggleDark()" class="cursor-pointer">Toggle Dark</div>
      <div onclick="logout()" class="cursor-pointer">Logout</div>
    </nav>
  </div>

  <!-- MAIN -->
  <div class="flex-1 p-8">

    <!-- DASHBOARD -->
    <div id="dashboardPage">
      <h1 class="text-2xl font-bold mb-6">Dashboard</h1>

      <div class="grid md:grid-cols-4 gap-6 mb-8">
        <div class="card p-6">
          <p>Total Sales</p>
          <h3 id="totalSales" class="text-2xl font-bold text-purple-600">â‚±0</h3>
        </div>
        <div class="card p-6">
          <p>Profit</p>
          <h3 id="profit" class="text-2xl font-bold text-purple-600">â‚±0</h3>
        </div>
        <div class="card p-6">
          <p>Orders</p>
          <h3 id="orderCount" class="text-2xl font-bold text-purple-600">0</h3>
        </div>
        <div class="card p-6">
          <p>Low Stock</p>
          <h3 id="lowStock" class="text-2xl font-bold text-red-500">0</h3>
        </div>
      </div>

      <div class="card p-6">
        <canvas id="salesChart"></canvas>
      </div>
    </div>

    <!-- ORDERS -->
    <div id="ordersPage" class="hidden">
      <h1 class="text-2xl font-bold mb-6">Orders</h1>

      <div class="card p-6 mb-6">
        <div class="grid md:grid-cols-4 gap-4">
          <input id="orderCustomer" placeholder="Customer Name"
            class="border p-2 rounded">
          <input id="orderProduct" placeholder="Product"
            class="border p-2 rounded">
          <input id="orderTotal" type="number" placeholder="Total"
            class="border p-2 rounded">
          <input id="orderDP" type="number" placeholder="Downpayment"
            class="border p-2 rounded">
        </div>
        <button onclick="addOrder()"
          class="bg-purple-600 text-white px-4 py-2 rounded mt-4 w-full">
          Save Order
        </button>
      </div>

      <div class="card p-6">
        <table class="w-full text-sm">
          <thead class="table-header">
            <tr>
              <th class="p-3 text-left">Customer</th>
              <th class="p-3 text-left">Product</th>
              <th class="p-3 text-left">Status</th>
              <th class="p-3 text-left">Balance</th>
              <th class="p-3 text-left">Actions</th>
            </tr>
          </thead>
          <tbody id="ordersTable"></tbody>
        </table>
      </div>
    </div>

    <!-- CUSTOMERS -->
    <div id="customersPage" class="hidden">
      <h1 class="text-2xl font-bold mb-6">Customers</h1>
      <div id="customersList" class="card p-6"></div>
    </div>

    <!-- INVENTORY -->
    <div id="inventoryPage" class="hidden">
      <h1 class="text-2xl font-bold mb-6">Inventory</h1>
      <div id="inventoryList" class="card p-6"></div>
    </div>

    <!-- BACKUP -->
    <div id="backupPage" class="hidden">
      <h1 class="text-2xl font-bold mb-6">Backup</h1>
      <div class="card p-6 space-y-4">
        <button onclick="exportBackup()" class="bg-purple-600 text-white px-4 py-2 rounded w-full">
          Export Backup
        </button>
        <input type="file" onchange="importBackup(event)" class="w-full">
        <button onclick="exportCSV()" class="bg-gray-800 text-white px-4 py-2 rounded w-full">
          Export Orders CSV
        </button>
      </div>
    </div>

  </div>
</div>

<script>

/* ================= STORAGE ================= */
const Storage = {
  get:(k)=>JSON.parse(localStorage.getItem(k))||[],
  set:(k,d)=>localStorage.setItem(k,JSON.stringify(d))
};

/* ================= LOGIN ================= */
function login(){
  let saved = localStorage.getItem("rjezm_pin");
  if(!saved){
    localStorage.setItem("rjezm_pin",pinInput.value);
    alert("PIN Set!");
  }else{
    if(pinInput.value!==saved){ alert("Wrong PIN"); return; }
  }
  loginScreen.classList.add("hidden");
  app.classList.remove("hidden");
  updateDashboard();
}

function logout(){
  app.classList.add("hidden");
  loginScreen.classList.remove("hidden");
}

/* ================= DARK MODE ================= */
function toggleDark(){
  document.body.classList.toggle("dark");
  localStorage.setItem("theme",
    document.body.classList.contains("dark")?"dark":"light");
}
if(localStorage.getItem("theme")==="dark"){
  document.body.classList.add("dark");
}

/* ================= NAV ================= */
function showPage(page){
  ["dashboard","orders","customers","inventory","backup"]
  .forEach(p=>document.getElementById(p+"Page").classList.add("hidden"));
  document.getElementById(page+"Page").classList.remove("hidden");
}

/* ================= DASHBOARD ================= */
let chart;

function updateDashboard(){
  let orders = Storage.get("orders");
  let inventory = Storage.get("inventory");

  let total = orders.reduce((a,b)=>a+b.total,0);
  let profit = orders.reduce((a,b)=>a+(b.total-b.dp),0);
  let low = inventory.filter(i=>i.qty<=i.min).length;

  totalSales.innerText="â‚±"+total;
  document.getElementById("profit").innerText="â‚±"+profit;
  orderCount.innerText=orders.length;
  lowStock.innerText=low;

  if(chart) chart.destroy();

  chart = new Chart(document.getElementById("salesChart"),{
    type:"bar",
    data:{
      labels:["Sales"],
      datasets:[{
        data:[total],
        backgroundColor:"#8B5CF6"
      }]
    }
  });

  renderOrders();
  renderCustomers();
  renderInventory();
}

/* ================= STATUS BADGE ================= */
function badge(status){
  const map={
    Pending:"bg-yellow-200 text-yellow-800",
    Printing:"bg-blue-200 text-blue-800",
    Ready:"bg-green-200 text-green-800",
    Released:"bg-purple-200 text-purple-800"
  };
  return `<span class="px-2 py-1 rounded text-xs ${map[status]||''}">${status}</span>`;
}

/* ================= ORDERS ================= */
function addOrder(){
  let orders = Storage.get("orders");
  orders.push({
    id:Date.now(),
    customer:orderCustomer.value,
    product:orderProduct.value,
    total:+orderTotal.value,
    dp:+orderDP.value,
    status:"Pending"
  });
  Storage.set("orders",orders);
  updateDashboard();
}

function renderOrders(){
  let orders = Storage.get("orders");
  let html="";
  orders.forEach(o=>{
    html+=`
    <tr class="border-b hover:bg-gray-50 dark:hover:bg-gray-700">
      <td class="p-3">${o.customer}</td>
      <td class="p-3">${o.product}</td>
      <td class="p-3">${badge(o.status)}</td>
      <td class="p-3">â‚±${o.total-o.dp}</td>
      <td class="p-3 space-x-2">
        <button onclick="editOrder(${o.id})" class="text-blue-600">Edit</button>
        <button onclick="printReceipt(${o.id})" class="text-purple-600">Receipt</button>
        <button onclick="deleteOrder(${o.id})" class="text-red-600">Delete</button>
      </td>
    </tr>`;
  });
  ordersTable.innerHTML=html;
}

function deleteOrder(id){
  let orders = Storage.get("orders").filter(o=>o.id!==id);
  Storage.set("orders",orders);
  updateDashboard();
}

function editOrder(id){
  let orders = Storage.get("orders");
  let o = orders.find(x=>x.id===id);
  let newTotal = prompt("New Total:",o.total);
  if(newTotal!==null){
    o.total=+newTotal;
    Storage.set("orders",orders);
    updateDashboard();
  }
}

/* ================= RECEIPT ================= */
function printReceipt(id){
  let o = Storage.get("orders").find(x=>x.id===id);
  let w=window.open("");
  w.document.write(`
    <h2>RJEZM DIGITAL</h2>
    <p>Customer: ${o.customer}</p>
    <p>Product: ${o.product}</p>
    <p>Total: â‚±${o.total}</p>
    <p>DP: â‚±${o.dp}</p>
    <p>Balance: â‚±${o.total-o.dp}</p>
  `);
  w.print();
}

/* ================= CUSTOMERS ================= */
function renderCustomers(){
  let orders = Storage.get("orders");
  let grouped={};
  orders.forEach(o=>{
    grouped[o.customer]=(grouped[o.customer]||0)+o.total;
  });
  let html="";
  Object.keys(grouped).forEach(name=>{
    html+=`<div class="border-b py-2">
      <strong>${name}</strong>
      <p>Total Spent: â‚±${grouped[name]}</p>
    </div>`;
  });
  customersList.innerHTML=html;
}

/* ================= INVENTORY ================= */
function renderInventory(){
  let inventory = Storage.get("inventory");
  let html="";
  inventory.forEach(i=>{
    let low=i.qty<=i.min?"text-red-500":"";
    html+=`<div class="border-b py-2 ${low}">
      ${i.name||"Material"} â€” ${i.qty||0}
    </div>`;
  });
  inventoryList.innerHTML=html;
}

/* ================= BACKUP ================= */
function exportBackup(){
  let data={
    orders:Storage.get("orders"),
    inventory:Storage.get("inventory")
  };
  let blob=new Blob([JSON.stringify(data)],{type:"application/json"});
  let a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="rjezm_backup.json";
  a.click();
}

function importBackup(e){
  let file=e.target.files[0];
  let reader=new FileReader();
  reader.onload=function(){
    let data=JSON.parse(reader.result);
    Object.keys(data).forEach(k=>Storage.set(k,data[k]));
    updateDashboard();
  };
  reader.readAsText(file);
}

function exportCSV(){
  let orders=Storage.get("orders");
  let csv="Customer,Product,Total,DP,Status\n";
  orders.forEach(o=>{
    csv+=`${o.customer},${o.product},${o.total},${o.dp},${o.status}\n`;
  });
  let blob=new Blob([csv],{type:"text/csv"});
  let a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="orders.csv";
  a.click();
}

</script>
</body>
</html>