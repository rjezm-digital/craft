<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RJEZM DIGITAL â€“ SaaS Premium</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
  --primary:#C8B6FF;
  --accent:#9D7BFF;
  --bg-light:#F6F0FF;
  --bg-dark:#1E1B2E;
  --card-dark:#2A2640;
}

body{
  background:var(--bg-light);
  transition:0.3s;
}

.dark{
  background:var(--bg-dark);
  color:white;
}

.sidebar{
  background:linear-gradient(180deg,#C8B6FF,#9D7BFF,#7B5BFF);
}

.glass{
  background:rgba(255,255,255,0.7);
  backdrop-filter:blur(12px);
  border-radius:20px;
  box-shadow:0 10px 25px rgba(0,0,0,0.08);
}

.dark .glass{
  background:var(--card-dark);
}
</style>
</head>
<body class="min-h-screen">

<!-- ================= LOGIN SCREEN ================= -->
<div id="loginScreen" class="flex items-center justify-center h-screen">
  <div class="glass p-8 w-80 text-center">
    <h1 class="text-2xl font-bold text-purple-700 mb-4">ðŸ’œ RJEZM DIGITAL</h1>
    <p class="mb-4">Enter PIN</p>
    <input type="password" id="pinInput" class="border p-2 rounded w-full mb-4 text-center" maxlength="6">
    <button onclick="login()" class="bg-purple-500 text-white px-4 py-2 rounded w-full">Unlock</button>
  </div>
</div>

<!-- ================= MAIN APP ================= -->
<div id="app" class="hidden flex">

  <!-- Sidebar -->
  <div class="sidebar w-64 min-h-screen text-white p-6 space-y-4">
    <h2 class="text-xl font-bold mb-6">ðŸ’œ RJEZM</h2>
    <div class="cursor-pointer" onclick="showPage('dashboard')">Dashboard</div>
    <div class="cursor-pointer" onclick="showPage('orders')">Orders</div>
    <div class="cursor-pointer" onclick="showPage('customers')">Customers</div>
    <div class="cursor-pointer" onclick="showPage('inventory')">Inventory</div>
    <div class="cursor-pointer" onclick="logout()">Logout</div>
  </div>

  <!-- Main Content -->
  <div class="flex-1 p-6">

    <!-- Topbar -->
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-2xl font-bold">Dashboard</h1>
      <button onclick="toggleDark()" class="bg-purple-500 text-white px-4 py-2 rounded">
        Toggle Dark
      </button>
    </div>

    <!-- Dashboard Cards -->
    <div id="dashboardPage">
      <div class="grid md:grid-cols-4 gap-6 mb-8">
        <div class="glass p-6">
          <p>Total Sales</p>
          <h3 id="totalSales" class="text-2xl font-bold text-purple-700">â‚±0</h3>
        </div>
        <div class="glass p-6">
          <p>Monthly Profit</p>
          <h3 id="monthlyProfit" class="text-2xl font-bold text-purple-700">â‚±0</h3>
        </div>
        <div class="glass p-6">
          <p>Active Orders</p>
          <h3 id="activeOrders" class="text-2xl font-bold text-purple-700">0</h3>
        </div>
        <div class="glass p-6">
          <p>Low Stock</p>
          <h3 id="lowStock" class="text-2xl font-bold text-purple-700">0</h3>
        </div>
      </div>

      <!-- Charts -->
      <div class="grid md:grid-cols-2 gap-6">
        <div class="glass p-6">
          <canvas id="salesChart"></canvas>
        </div>
        <div class="glass p-6">
          <canvas id="ordersChart"></canvas>
        </div>
      </div>
    </div>

    <!-- Placeholder Pages -->
    <div id="ordersPage" class="hidden"><h2>Orders Page (Part 2)</h2></div>
    <div id="customersPage" class="hidden"><h2>Customers Page (Part 2)</h2></div>
    <div id="inventoryPage" class="hidden"><h2>Inventory Page (Part 2)</h2></div>

  </div>
</div>

<script>
/* ================= STORAGE ADAPTER ================= */
const Storage = {
  get:(key)=>JSON.parse(localStorage.getItem(key)) || [],
  set:(key,data)=>localStorage.setItem(key,JSON.stringify(data))
};

/* ================= LOGIN SYSTEM ================= */
function login(){
  let savedPIN = localStorage.getItem("rjezm_pin");

  if(!savedPIN){
    localStorage.setItem("rjezm_pin", pinInput.value);
    alert("PIN Set Successfully!");
  }else{
    if(pinInput.value !== savedPIN){
      alert("Incorrect PIN");
      return;
    }
  }

  loginScreen.classList.add("hidden");
  app.classList.remove("hidden");
}

function logout(){
  app.classList.add("hidden");
  loginScreen.classList.remove("hidden");
}

/* ================= DARK MODE ================= */
function toggleDark(){
  document.body.classList.toggle("dark");
  localStorage.setItem("rjezm_theme",
    document.body.classList.contains("dark") ? "dark":"light"
  );
}

if(localStorage.getItem("rjezm_theme")==="dark"){
  document.body.classList.add("dark");
}

/* ================= PAGE NAVIGATION ================= */
function showPage(page){
  ["dashboardPage","ordersPage","customersPage","inventoryPage"]
  .forEach(id=>document.getElementById(id).classList.add("hidden"));

  document.getElementById(page+"Page").classList.remove("hidden");
}

/* ================= DASHBOARD LOGIC ================= */
function updateDashboard(){
  let sales = Storage.get("sales");
  let orders = Storage.get("orders");
  let inventory = Storage.get("inventory");
  let expenses = Storage.get("expenses");

  let totalSales = sales.reduce((a,b)=>a+b,0);
  let totalExpense = expenses.reduce((a,b)=>a+b,0);
  let lowStock = inventory.filter(i=>i.qty<=i.min).length;

  document.getElementById("totalSales").innerText="â‚±"+totalSales;
  document.getElementById("monthlyProfit").innerText="â‚±"+(totalSales-totalExpense);
  document.getElementById("activeOrders").innerText=orders.length;
  document.getElementById("lowStock").innerText=lowStock;

  renderCharts(totalSales, orders.length);
}

/* ================= CHARTS ================= */
let salesChart, ordersChart;

function renderCharts(totalSales, totalOrders){
  if(salesChart) salesChart.destroy();
  if(ordersChart) ordersChart.destroy();

  salesChart = new Chart(document.getElementById("salesChart"),{
    type:"bar",
    data:{
      labels:["Total Sales"],
      datasets:[{
        data:[totalSales],
        backgroundColor:"#9D7BFF"
      }]
    }
  });

  ordersChart = new Chart(document.getElementById("ordersChart"),{
    type:"doughnut",
    data:{
      labels:["Orders"],
      datasets:[{
        data:[totalOrders],
        backgroundColor:["#C8B6FF"]
      }]
    }
  });
}

updateDashboard();
</script>

/* ================= STATUS BADGES ================= */
function statusBadge(status){
  const colors = {
    Pending:"bg-yellow-200 text-yellow-800",
    Printing:"bg-blue-200 text-blue-800",
    Ready:"bg-green-200 text-green-800",
    Released:"bg-purple-200 text-purple-800"
  };
  return `<span class="px-2 py-1 rounded text-xs ${colors[status]||''}">${status}</span>`;
}

/* ================= EDIT ORDER ================= */
function editOrder(id){
  let orders = Storage.get("orders");
  let o = orders.find(x=>x.id===id);

  let modal = `
  <div id="editModal" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center">
    <div class="glass p-6 w-96">
      <h2 class="text-lg font-bold mb-4">Edit Order</h2>
      <input id="editCustomer" value="${o.customer}" class="border p-2 rounded w-full mb-2">
      <input id="editProduct" value="${o.product}" class="border p-2 rounded w-full mb-2">
      <input id="editTotal" type="number" value="${o.total}" class="border p-2 rounded w-full mb-2">
      <input id="editDP" type="number" value="${o.dp}" class="border p-2 rounded w-full mb-2">
      <button onclick="saveEdit(${id})" class="bg-purple-500 text-white px-4 py-2 rounded w-full mb-2">Save</button>
      <button onclick="closeModal()" class="bg-gray-400 text-white px-4 py-2 rounded w-full">Cancel</button>
    </div>
  </div>`;
  document.body.insertAdjacentHTML("beforeend",modal);
}

function saveEdit(id){
  let orders = Storage.get("orders");
  let o = orders.find(x=>x.id===id);

  o.customer = editCustomer.value;
  o.product = editProduct.value;
  o.total = Number(editTotal.value);
  o.dp = Number(editDP.value);

  Storage.set("orders",orders);
  closeModal();
  renderOrders();
  updateDashboard();
}

function closeModal(){
  document.getElementById("editModal").remove();
}

/* ================= PRINTABLE RECEIPT VIEW ================= */
function printReceipt(id){
  let orders = Storage.get("orders");
  let o = orders.find(x=>x.id===id);

  let w = window.open("");
  w.document.write(`
    <h2>RJEZM DIGITAL</h2>
    <p>Customer: ${o.customer}</p>
    <p>Product: ${o.product}</p>
    <p>Total: â‚±${o.total}</p>
    <p>DP: â‚±${o.dp}</p>
    <p>Balance: â‚±${o.total-o.dp}</p>
    <p>Status: ${o.status}</p>
    <p>Date: ${new Date().toLocaleDateString()}</p>
  `);
  w.print();
}

/* ================= MONTHLY ANALYTICS ================= */
function monthlyAnalytics(){
  let orders = Storage.get("orders");
  let month = new Date().getMonth();
  let thisMonth = orders.filter(o=>{
    let d = new Date(o.id);
    return d.getMonth()===month;
  });
  alert("Orders This Month: "+thisMonth.length);
}

/* ================= BACKUP & RESTORE ================= */
function exportBackup(){
  let data = {
    orders:Storage.get("orders"),
    customers:Storage.get("customers"),
    inventory:Storage.get("inventory"),
    sales:Storage.get("sales"),
    expenses:Storage.get("expenses")
  };
  let blob = new Blob([JSON.stringify(data)],{type:"application/json"});
  let a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download="rjezm_backup.json";
  a.click();
}

function importBackup(event){
  let file = event.target.files[0];
  let reader = new FileReader();
  reader.onload=function(){
    let data = JSON.parse(reader.result);
    Object.keys(data).forEach(k=>Storage.set(k,data[k]));
    renderOrders();
    renderCustomers();
    renderInventory();
    updateDashboard();
    alert("Backup Restored");
  };
  reader.readAsText(file);
}

/* ================= EXPORT CSV ================= */
function exportCSV(){
  let orders = Storage.get("orders");
  let csv="Customer,Product,Total,DP,Status\n";
  orders.forEach(o=>{
    csv+=`${o.customer},${o.product},${o.total},${o.dp},${o.status}\n`;
  });
  let blob=new Blob([csv],{type:"text/csv"});
  let a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="orders.csv";
  a.click();
}

/* ================= LOGO UPLOAD ================= */
function uploadLogo(event){
  let reader = new FileReader();
  reader.onload=function(){
    localStorage.setItem("rjezm_logo",reader.result);
    document.getElementById("logoImg").src=reader.result;
  };
  reader.readAsDataURL(event.target.files[0]);
}

window.addEventListener("load",()=>{
  let logo = localStorage.getItem("rjezm_logo");
  if(logo && document.getElementById("logoImg")){
    document.getElementById("logoImg").src=logo;
  }
});

/* ================= AUTO LOCK SYSTEM ================= */
let inactivityTimer;

function resetTimer(){
  clearTimeout(inactivityTimer);
  inactivityTimer = setTimeout(()=>{
    alert("Session Locked due to inactivity.");
    logout();
  }, 300000); // 5 minutes
}

["click","mousemove","keypress","touchstart"]
.forEach(evt=>document.addEventListener(evt,resetTimer));

resetTimer();

/* ================= LOW STOCK POPUP ================= */
function checkLowStockAlert(){
  let inventory = Storage.get("inventory");
  let low = inventory.filter(i=>i.qty<=i.min);
  if(low.length>0){
    alert("âš  Low Stock Alert: " + low.map(i=>i.name).join(", "));
  }
}
checkLowStockAlert();

/* ================= PROFIT MARGIN TRACKER ================= */
function profitMargin(){
  let sales = Storage.get("orders").reduce((a,b)=>a+b.total,0);
  let expenses = Storage.get("expenses").reduce((a,b)=>a+b,0);
  let profit = sales-expenses;
  let margin = sales>0 ? ((profit/sales)*100).toFixed(1) : 0;
  alert("Profit Margin: "+margin+"%");
}

/* ================= BEST SELLING PRODUCT ================= */
function bestSelling(){
  let orders = Storage.get("orders");
  let count={};
  orders.forEach(o=>{
    count[o.product]=(count[o.product]||0)+1;
  });
  let best = Object.keys(count).sort((a,b)=>count[b]-count[a])[0];
  alert("Best Selling Product: "+(best||"None"));
}

/* ================= MONTHLY SALES BREAKDOWN CHART ================= */
function monthlyBreakdown(){
  let orders = Storage.get("orders");
  let monthly = {};

  orders.forEach(o=>{
    let month = new Date(o.id).toLocaleString('default',{month:'short'});
    monthly[month]=(monthly[month]||0)+o.total;
  });

  let ctx = document.getElementById("salesChart");
  if(window.salesChart) window.salesChart.destroy();

  window.salesChart = new Chart(ctx,{
    type:"line",
    data:{
      labels:Object.keys(monthly),
      datasets:[{
        label:"Monthly Sales",
        data:Object.values(monthly),
        borderColor:"#9D7BFF",
        backgroundColor:"rgba(157,123,255,0.2)"
      }]
    }
  });
}

/* ================= DEADLINE CALENDAR VIEW ================= */
function calendarView(){
  let orders = Storage.get("orders");
  let html="<h3>Upcoming Deadlines</h3>";
  orders.forEach(o=>{
    html+=`<p>${o.customer} - ${o.product} (${new Date(o.id).toLocaleDateString()})</p>`;
  });
  alert(html.replace(/<[^>]*>?/gm,''));
}

/* ================= ANIMATED COUNTERS ================= */
function animateCounter(id, target){
  let el = document.getElementById(id);
  let start=0;
  let increment = target/50;

  let interval = setInterval(()=>{
    start+=increment;
    if(start>=target){
      start=target;
      clearInterval(interval);
    }
    el.innerText="â‚±"+Math.floor(start);
  },20);
}

/* ================= PWA INSTALL SUPPORT ================= */
let deferredPrompt;

window.addEventListener('beforeinstallprompt',(e)=>{
  e.preventDefault();
  deferredPrompt = e;
  console.log("App can be installed.");
});

function installApp(){
  if(deferredPrompt){
    deferredPrompt.prompt();
  }else{
    alert("Install option available from browser menu.");
  }
}

</script>
</script>

</body>
</html>